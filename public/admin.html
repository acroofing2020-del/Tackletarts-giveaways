<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    h1 { color: #333; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #eee; }
    .section { margin-bottom: 40px; }
  </style>
</head>
<body>
  <h1>ðŸŽ£ Admin Dashboard</h1>

  <div class="section">
    <h2>Latest Tickets</h2>
    <table id="ticketsTable">
      <thead>
        <tr>
          <th>Email</th>
          <th>Competition</th>
          <th>Result</th>
          <th>Ticket #</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button onclick="resetTickets()">Reset Tickets</button>
  </div>

  <div class="section">
    <h2>Competition Manager</h2>
    <form onsubmit="addCompetition(event)">
      <input type="text" id="name" placeholder="Name" required>
      <input type="text" id="desc" placeholder="Description" required>
      <input type="text" id="image" placeholder="Image URL (e.g. /images/rod.png)" required>
      <button type="submit">Add Competition</button>
    </form>

    <h3>Existing Competitions</h3>
    <table id="compsTable">
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Description</th>
          <th>Active</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    async function loadTickets() {
      const res = await fetch("/api/admin/tickets");
      const data = await res.json();
      const tbody = document.querySelector("#ticketsTable tbody");
      tbody.innerHTML = "";
      data.forEach(t => {
        tbody.innerHTML += `<tr>
          <td>${t.email}</td>
          <td>${t.competition}</td>
          <td>${t.result}</td>
          <td>${t.number}</td>
          <td>${t.time}</td>
        </tr>`;
      });
    }

    async function resetTickets() {
      if (!confirm("Reset all tickets?")) return;
      await fetch("/api/admin/reset", { method: "POST" });
      loadTickets();
    }

    async function loadCompetitions() {
      const res = await fetch("/api/admin/competitions");
      const data = await res.json();
      const tbody = document.querySelector("#compsTable tbody");
      tbody.innerHTML = "";
      data.forEach(c => {
        tbody.innerHTML += `<tr>
          <td>${c.id}</td>
          <td>${c.name}</td>
          <td>${c.description}</td>
          <td>${c.active ? "Yes" : "No"}</td>
          <td>
            <button onclick="toggleComp(${c.id})">Toggle</button>
            <button onclick="deleteComp(${c.id})">Delete</button>
          </td>
        </tr>`;
      });
    }

    async function addCompetition(e) {
      e.preventDefault();
      const name = document.getElementById("name").value;
      const desc = document.getElementById("desc").value;
      const image = document.getElementById("image").value;
      await fetch("/api/admin/competitions", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, description: desc, image })
      });
      loadCompetitions();
    }

    async function toggleComp(id) {
      await fetch(`/api/admin/competitions/${id}/toggle`, { method: "POST" });
      loadCompetitions();
    }

    async function deleteComp(id) {
      if (!confirm("Delete this competition?")) return;
      await fetch(`/api/admin/competitions/${id}`, { method: "DELETE" });
      loadCompetitions();
    }

    loadTickets();
    loadCompetitions();
  </script>
</body>
</html>
